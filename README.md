# testSB

Перед выполнением нужно заполнить Регистры сведений "Тарифы услуг сортировки", "Тарифы обработки хабов" и "Календарные графики".  
На формах списка РС есть кнопки для заполнения по умолчанию. Календарные графики заполняются за 2022 год без праздников, выходные суббота-воскресение.  
Рассчет по праздничным, нерабочим дням должн отрабатывать корректно.
Должна быть заполнена константа "Основной календарь"  

Рассчет выполняется документом "Загрузка данных". Документ не проводится. По кнопке "Прочитать файл" данные записываются в регистр накопления "Стоимость услуг сортировки",  
по кнопке "Очистить данные" очищаются записи в РН по документу.  

Файл загрузки должен быть доступным на сервере 1С, при необходимости можно доработать передачу файла с клиента на сервер.  

Файл csv считывается по строчно, строка парсится функцией СтрРазделить(Строка, ",", Истина). Могут быть проблемы, если в текстовых полях присутствуют символы разделители.  

Стоимость услуги обработки считается по действующему тарифу на дату убытия ГМ.  
Стоимость хранения считается так же по действующему тарифу на дату убытия ГМ, даже если хранилось больше месяца и за время хранения изменился тариф.  

Можно сделать рассчет стоимости хранения по тарифу, который менялся во время хранения. Это немного усложнит код и незначительно увеличит время обработки.  

Среднедневное количество единиц проходящий через хаб для расчета стоимости услуги обработки считается по количеству убытий ГМ за месяц (с учетом поступивших данных о убытии ГМ в файле).  


Расчет выполняется в три потока. Отдельно считается стоимость обработки Хаб и не Хаб, стоимость хранения.  
На сервере для разработки у меня загрузка файла занимала примерно 7-8 минут.  
Если выполнять в один поток последовательно, примерно 50% времени занимает запись в РН "Стоимость услуг сортировки", 20% СтрРазделить.
